# Организация веток

В настоящее время (06.06.2019) текущая версия библиотеки (нестабильная) содержится в ветке  `next`, она является основной и релизной. Все изменения попадают в эту ветку через Pull Request с обязательным code-rewiew.

На данный момент ведется разработка стабильного API, поэтому с развитием библиотеки и выходом первой стабильной версии (v1.0.0) ветка `next` будет смержена в `master` и удалена (или будет выполнять роль предрелизной ветки), в следствии чего `master` станет основной веткой.

Остальные ветки содержат в себе прошлые версии:
| Branch name | Projects |
|-|-|
| 0.1-stable | Личный кабинет абонента Астрал.Отчет |
| 0.2-stable, master | Celsus, HR, OKK, ChiefPersonArea|

На 06.06.2019 последней наиболее стабильной версией считается версия библиотеки, находящаяся в ветке `0.2-stable`, поэтому ветка `master` равна `0.2-stable`.

До выхода первой стабильной версии библиотеки API считается нестабильным, поэтому все старые версии хранятся в ветках, обратной совместимости между этими ветками нет.

# Версионирование

Включительно до версии `0.2-stable` библиотека распространялась исключительно при помощи `git submodule`. Последняя версия библиотеки распространяется и через `git submodule`, и через `npm`.

В случае использования `git submodule` номер коммита является версией библиотеки.

Распространиение через `npm` следует принципу [Semantic Versioning](https://semver.org/). На данный момент самая последняя версия библиотеки в `npm-registry` имеет версию `v0.1.x`, в будущем, с появлением стабильной версии библиотеки, версия будет изменена на `v1.x.x`.

# Процесс разработки

На данный момент библиотека не поддерживает автоматических тестов. Поэтому, после изменений в кодовой базе, проверятся только при помощи `eslint`.

Для поддержания кодовой базы в консистентном состоянии используется `git hooks` и пакет `lint-staged` для линтинга измененых файлов локально. Также в будущем `eslint` будет включен в CI.

Для опубликования новой версии библиотеки необходимо выполнить следующие команды:

1. `cd /to/target/package/folder`
2. `npm build`
3. `npm publish ./lib`

В будущем предлагается использовать `semantic-release` для автоматического распространения библиотеки.

# Обзор кодовой базы
Вся библиотека разделена на пакеты. Все пакеты находятся в папке `./packages`.

`@astral/core` - "зеркало" пакета `@material-ui/core`, вынесенен, чтобы использовать единую версию `@material-ui/core`.

`@astral/components` - пакет, содержащий общие, простые, кастомизированные компоненты.

`@astral/dashboard-layout` - компоненты для dashboard.

`@astral/account-layout` - компоненты для страницы авторизации.

`@astral/constants` - различные полезные константы (http, время и пр).

`@astral/forms` - обертка для `react-final-form`.

`@astral/icons` - иконки, используемые в остальных пакетах (не проектные иконки).

`@astral/fonts` - оптимизированые шрифты.

`@astral/styles` - утилы для стилизации компонентов, также может быть использованно в приложении.

`@astral/themes` - пакет, содержащий material-ui темы для различных приложений.

`@astral/validations` - пакет, содержащий утилиты для валидации форм.

Подробное описание можно прочитать в каждом из пакетов.

## Соглашения

- Весь код, содержащийся в этом репозитории, следует принципам, описанным в книге [Чистый код](https://github.com/maksugr/clean-code-javascript)

- Если компонент содержит в себе подкомпоненты (осуществляется доступ через точку - Component.SubComponent), то операция присваивания должна происходить в индексном файле (Component.SubComponent = SubComponent)

### Именование обработчиков событий:
Функция обработчик событий должна начинаться со слова handle, далее идет имя компонента и уже потом только действие, которое обрабатывается.

```js
const handleSearchInputChange = () => {
  doSomeActions();
};

<SearchInput onChange={handleSearchInputChange}>
```

### Именование функций-утилит:

Имена функции должны говорить о том, что они делают, и выполнять только одно действие.

```js
const getIsTextVariant = variant => (variant === 'textBlock' || variant === 'regularBlock');

```

### Стилизация

Все размеры fontSize и lineHeight должны быть в rem. Расчитываются функцией theme.typography.pxToRem. Размеры указываются для десктопной версии, для остальных расчитаются сами.

### Именование "специальных" пропов

Имя любого пропса, который принимает в себя компонент, должен начинаться с большой буквы (Icon, Text, Actions).

```jsx
<TableRow Actions={() => (
  <TableRowActions>
    <IconButton onClick={handleDeleteButtonClick}>
      <DeleteIcon>
    </IconButton>
  </TableRowActions>
)}>
```

Имя любого пропса, который принимает в себя элемент, должен начинаться с маленькой буквы (children, component).

```jsx
const FlexItem = ({
  classes, className, component: Component, grow, ...props
}) => (
  <Component className={cn(classes.root, className)} {...props} />
);


<FlexItem component={TextField} name="fieldName" />
```

Все контексты, не предназначенные для изменения, импортятся из index.js файла как __Context.

```
export { default } from './Dialog';
export { default as __Context } from './DialogContext';
```
